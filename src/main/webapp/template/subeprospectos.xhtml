<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:j="http://xmlns.jcp.org/jsf"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:a="http://xmlns.jcp.org/jsf/passthrough"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:fn="http://java.sun.com/jsp/jstl/functions">

    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link href="../resources/css/default.css" rel="stylesheet"/>
        <link href="../resources/css/dataTables.bootstrap4.css" rel="stylesheet"/>
        <link href="../resources/css/bootstrap.min.css" rel="stylesheet"/>
        <link href="../resources/css/sb-admin.css" rel="stylesheet"/>
        <link href="../resources/fontawesome-free/css/all.min.css" rel="stylesheet"/>
        <title>Quantum - Flamencos</title>
        <style>
            a:not([href]):not([tabindex]):hover, a:not([href]):not([tabindex]):focus {
                color: #0056b3 !important;
                text-decoration: none;
            }
        </style>
    </head>

    <body>

        <ui:composition template="./plantilla.xhtml">

            <ui:define name="content">
                <c:set var = "fprospecto" value = "${fn:replace(prospecto.fecha_prospecto, 'T', '&#160; &#160;')}" />
                <c:set var = "fretiro" value = "${fn:replace(prospecto.fecharetiro, 'T', '&#160; &#160;')}" />
                <f:event type="preRenderView" listener="#{subeprospectosBean.listaradmin()}"/>
                <div class="row">
                    <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6 grid-margin" style="margin-bottom: 10px;">
                         <div class="media" style="padding: 0.5rem 1.5rem !important;">
                                    <i class="mdi mdi-cloud-upload icon-md text-primary d-flex align-self-start mr-2"></i>
                                    <div class="media-body">
                                        <p class="card-text"><h3 class="card-title">Carga de Prospectos</h3></p>
                                    </div>
                                </div>
                        <!--<div class="card">
                            <div class="card-body" style="padding: 0.5rem 0.5rem !important;">
                                <div class="media">
                                    <i class="mdi mdi-cloud-upload icon-md text-primary d-flex align-self-start mr-2"></i>
                                    <div class="media-body">
                                        <p class="card-text"><h3 class="card-title">Carga de Prospectos</h3></p>
                                    </div>
                                </div>
                            </div>
                        </div>-->
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6 grid-margin" style="margin-bottom: 10px;">
                        <div class="card">
                            <div class="card-body" style="padding: 0.5rem 0.5rem !important;">
                                <div class="media">
                                    <i class="mdi mdi-account-multiple-plus icon-md text-primary d-flex align-self-start mr-2"></i>
                                    <div class="media-body">
                                        <p class="card-text"><h3 class="card-title">Asignación a Supervisores</h3></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 grid-margin ">
                        <div class="from-group">
                            <div id="mensaje" style="display: #{subeprospectosBean.message.display}" class="mt-3 alert alert-#{subeprospectosBean.message.clase} form-row">
                                <div class="col-3">
                                    <i class="mdi #{subeprospectosBean.message.ico} text-#{subeprospectosBean.message.clase} icon-md "></i>
                                </div>
                                <div class="col-8">
                                    <span class="font-weight-medium text-right">#{subeprospectosBean.message.mensaje}</span>
                                </div>
                            </div>
                        </div>   
                    </div>
                    <div class="col-md-6 grid-margin stretch-card">
                        <div class="card">
                            <div class="card-body">
                                <form j:id="formasig" class="forms-sample" enctype="multipart/form-data"  onSubmit="return validate();">
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-lg-12 col-sm-12 col-12">
                                                <div class="from-group">
                                                    <label>Archivo de Prospectos</label>
                                                    <div class="input-group">

                                                        <input id="namefile" type="text" class="form-control file-upload-info" disabled="" placeholder="Subir Archivo"/>
                                                        <label class="input-group-append" style="margin-bottom: 0 !important; ">

                                                            <span class="btn btn-secondary">
                                                                Examinar
                                                                <input type="file" id="file" required="true" j:value="#{subeprospectosBean.file}" style="display: none; " accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel">

                                                                </input>
                                                            </span>
                                                        </label>
                                                        <label class="input-group-append" style="margin-bottom: 0 !important; ">
                                                            <button class="file-upload-browse btn btn-info" type="submit" j:action="#{subeprospectosBean.cargArchivo}">Procesar</button>
                                                        </label>
                                                    </div>
                                                </div>
                                                <br/>
                                                <div class="from-group registros">

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </form>

                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 d-flex align-items-stretch grid-margin">
                        <div class="row flex-grow">

                            <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 col-xl-6 " style="margin-bottom: 0 !important; " >
                                <!--  <div class="card card-statistics">-->
                                <div class="card" style="padding: 0.7rem !important;">
                                    <div class="form-group row">
                                        <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6 ">
                                            <i class="mdi mdi-arrow-down-bold-box text-danger icon-md"></i>
                                        </div>
                                        <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6 ">
                                            <p class="mb-0 text-right">Prospectos sin Asignar</p>
                                            <h3 class="text-right mb-0" ><label style="font-size: 25px !important;" for="parasig"></label></h3>

                                        </div>
                                    </div>
                                    <!-- </div>-->
                                </div>
                            </div>  
                            <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 col-xl-6 " style="margin-bottom: 0px !important;">
                                <div class="card" style="padding: 0.7rem !important;">
                                    <div class="form-group row">
                                        <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6 ">
                                            <i class="mdi mdi-arrow-up-bold-box text-success icon-md"></i>
                                        </div>
                                        <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6 ">
                                            <p class="mb-0 text-right">Prospectos Asignados</p>
                                            <h3 class="font-weight-medium text-right mb-0"><label style="font-size: 25px !important;" for="asig"></label></h3>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            <div class="col-12 stretch-card mt-2">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <form j:id="formasigsup" method="post">
                                                <table class="table  table-sm" style="width:100%">
                                                    <thead>
                                                        <tr>
                                                            <th scope="col" style="width: 50%" >Asesor</th>
                                                            <th scope="col" style="width: 25%;" >Cantidad</th>
                                                        </tr>
                                                    </thead>
                                                    <tfoot >
                                                        <tr>
                                                            <th scope="col">Asesor</th>
                                                            <th scope="col">Cantidad</th>
                                                        </tr>
                                                    </tfoot>
                                                    <tbody>
                                                        <ui:repeat value="#{subeprospectosBean.lstDistribucion}" var="asesor">
                                                            <tr>
                                                                <td>#{asesor.nombre} #{asesor.apellido}</td>
                                                                <td >
                                                                    <input type="number" class="form-control cantidad col-md-5 col-xs-12 col-sm-12"  placeholder="0" j:value="#{asesor.cantidad}" min="0" step="1" maxlength="5" />
                                                                </td>

                                                            </tr>
                                                        </ui:repeat>
                                                    </tbody>
                                                </table>
                                                <button type="submit" class="btn btn-success mr-2" j:actionListener="#{subeprospectosBean.operar()}" > 
                                                    Asignar
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="col-12 grid-margin">
                        <div class="media" style="padding: 0.5rem 1.5rem !important;">
                                    <i class="mdi mdi-repeat icon-md text-primary d-flex align-self-start mr-2"></i>
                                    <div class="media-body">
                                        <p class="card-text"><h3 class="card-title">Leads Repetidos</h3></p>
                                    </div>
                                </div>
                        <!--<div class="card">
                            <div class="card-body" style="padding: 0.5rem 0.5rem !important;">
                                <div class="media">
                                    <i class="mdi mdi-repeat icon-md text-primary d-flex align-self-start mr-2"></i>
                                    <div class="media-body">
                                        <p class="card-text"><h3 class="card-title">Leads Repetidos</h3></p>
                                    </div>
                                </div>
                            </div>
                        </div>-->
                    </div>

                    <div class="col-lg-12 grid-margin stretch-card">
                        <div class="card">
                            <div class="card-body">

                                <div class="table-responsive">
                                    <table class="table table-striped dataTable table-sm" style="width:100%">
                                        <thead>
                                            <tr >
                                                <th>Fecha de Prospectos</th>
                                                <th>Fecha Reiterado</th>
                                                <th>Prospecto</th>
                                                <th>Asesor</th>
                                                <th><i class="mdi mdi-eye-outline  mdi-18px text-center"></i></th>
                                                <th><i class="mdi mdi-swap-horizontal  mdi-18px text-center"></i></th>
                                                <th><i class="mdi mdi-check  mdi-18px text-center"></i></th>
                                            </tr>
                                        </thead>
                                        <tfoot>
                                            <tr >
                                                <th>Fecha de Prospectos</th>
                                                <th>Fecha Reiterado</th>
                                                <th>Prospecto</th>
                                                <th>Asesor</th>
                                                <th><i class="mdi mdi-eye-outline  mdi-18px text-center"></i></th>
                                                <th><i class="mdi mdi-swap-horizontal  mdi-18px text-center"></i></th>
                                                <th><i class="mdi mdi-check  mdi-18px text-center"></i></th>
                                            </tr>
                                        </tfoot>
                                        <tbody>
                                            <ui:repeat value="#{subeprospectosBean.lstprospectosrepetidos}" var="prospecto">
                                                <tr>
                                                    <td>${fprospecto}</td>
                                                    <td>${fretiro}</td>
                                                    <td>#{prospecto.nombreapellido}</td>
                                                    <td>
                                                        <img class="img-xs rounded-circle mr-2" src="../resources/images/faces/#{prospecto.imgasesor}" alt="Profile image"/>#{prospecto.asesor}
                                                    </td>
                                                    <td>
                                                        <form j:id="formgestion" class="col-sm-2" method="post">  
                                                            <a class="nav-link" j:action="#{subeprospectosBean.leerIdtoGestion(prospecto, session)}" title="Ver Gestion">
                                                                <i class="mdi mdi-eye-outline text-dark mdi-18px"></i>
                                                            </a>
                                                        </form>
                                                    </td>
                                                    <td>
                                                        <h:form id="formmodel" class="col-sm-2" >
                                                            <a class="nav-link " style="cursor: pointer; color:#007bff;" immediate="true" onclick="$('#modalchange').modal('show');" title="Cambiar de Asesor"> 
                                                                <f:ajax event="click" listener="#{subeprospectosBean.pasaProspecto(prospecto)}" render="asesormodel" execute="@this"/>
                                                                <i  class="mdi mdi-swap-horizontal text-dark mdi-18px"></i>
                                                            </a>
                                                        </h:form>
                                                    </td>
                                                    <td>
                                                        <form j:id="formcheckok" class="col-sm-2" >
                                                            <a class="nav-link " style="cursor: pointer; color:#007bff;" j:action="#{subeprospectosBean.checkok(prospecto)}" title="Guardar a Asesor"> 
                                                                <i  class="mdi  mdi-check text-dark mdi-18px"></i>
                                                            </a>
                                                        </form>
                                                    </td>

                                                </tr>
                                            </ui:repeat>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="container">
                    <div class="modal fade" id="modalchange" role="dialog">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <form method="post" j:id="asesormodel"  onsubmit= "return validar_formulario()">
                                    <div class="modal-header" style="background: linear-gradient(120deg, #00e4d0, #5983e8); ">
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span class="mdi mdi-close text-white" aria-hidden="true"></span>
                                        </button>
                                    </div>
                                    <div class="modal-body" style="padding: 15px 15px 7px 15px !important;">
                                        <div class="card">
                                            <div class="card-body" style="padding: 1.25rem !important;">
                                                <div class="form-group row">
                                                    <div class="col-md-8">
                                                        <h6 class="display-5">Cambio de Asesor</h6>
                                                    </div>
                                                </div>
                                                <div class="form-group row">
                                                    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6">
                                                        <label >Asesor Actual</label><br/>
                                                        <img class="img-xs rounded-circle mr-2" src="../resources/images/faces/#{subeprospectosBean.prospectomodal.imgasesor}" alt="Profile image"/><label >#{subeprospectosBean.prospectomodal.asesor}</label> 
                                                    </div>
                                                    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6">
                                                        <label for="asesores">Asesor a Asignar</label>
                                                        <h:selectOneMenu id="asesores" class="form-control"  value="#{subeprospectosBean.newasesor}" required="true" requiredMessage="Seleccione un Asesor">
                                                            <f:selectItem itemLabel="Seleccione un Asesor" noSelectionOption="true" itemValue="" />
                                                            <f:selectItems value="#{subeprospectosBean.lstasesores}" var="asesores" itemLabel="#{asesores.nombres} #{asesores.apellidos}" itemValue="#{asesores.correo}"/>

                                                        </h:selectOneMenu>
                                                    </div>
                                                </div>
                                                <div class="form-group row">
                                                    <div id="mesagevalidation" class="alert alert-warning alert-dismissible fade show" role="alert" style="margin: 0 auto; display: none;">
                                                        <strong>Debe</strong> colocar el asesor a asignar.
                                                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                                            <span class="mdi mdi-close text-white" aria-hidden="true"></span>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="modal-footer" style="padding: 0 15px 15px 0">


                                        <button type="submit" id="btn_change" class="btn btn-default btn-success" j:actionListener="#{subeprospectosBean.cambiar()}" >Cambiar</button>

                                        <p id="demo"></p>

                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                </div>


                <div class="container">
                    <!-- Modal -->
                    <div class="modal fade" id="myModal" role="dialog">
                        <div class="modal-dialog">

                            <!-- Modal content-->
                            <div class="modal-content">

                                <div class="modal-header" style="background: linear-gradient(120deg, #00e4d0, #5983e8);">
                                    <h4 style="margin-top: 0.5rem;" class="modal-title">Informe de Errores</h4>
                                </div>
                                <div class="modal-body">
                                    <p id="text-error"></p>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal" >Cerrar</button>

                                </div>

                            </div>

                        </div>
                    </div>

                </div>


                <script src="../resources/js/jquery-3.3.1.min.js"></script>
                <script src="../resources/js/jquery.dataTables.min.js"></script>
                <script type="text/javascript">
                                    //<![CDATA[
                                    var lista = #{subeprospectosBean.campos};
                                    var listacampos = #{subeprospectosBean.lstcampos};
                                    var selecccionados = [];
                                    var v_anterior = "";
                                    $(document).ready(function () {


                                        if (lista.length !== 0) {
                                            lista.forEach(recorrecampos);
                                            $(".registros").after('<div class="row"> <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">' +
                                                    '<button type="button" class="btn btn-default float-right" onclick="procesar()">Procesar</button></div>');

                                        }
                                    });

                                    function recorrecampos(i, index, array) {
                                        var idcampo = i + "-" + index;

                                        $(".registros").append('<div class="form-group row justify-content-center"> <div class="col-sm-3 col-md-3 col-lg-3 col-xl-3"><h4 class="card-title text-right col-form-label">' + i + '</h4>  ' +
                                                '</div><div class="col-sm-12 col-md-5 col-lg-5 col-xl-5 ' + index + '"></div>' +
                                                ' </div>');
                                        var selectcampos = document.createElement('select');
                                        selectcampos.id = idcampo;
                                        selectcampos.className = "form-control sel";
                                        selectcampos.setAttribute("onchange", "accion(this)");
                                        selectcampos.setAttribute("onclick", "anterior(this)");
                                        selectcampos.setAttribute("data-toggle", "tooltip");
                                        selectcampos.setAttribute("title", "Debe selecccionar una opcion");
                                        option = document.createElement("option");
                                        option.text = "Seleccione el equivalente";
                                        option.disabled = true;
                                        option.selected = true;
                                        selectcampos.appendChild(option);
                                        listacampos.forEach(function (j, jndex, array) {


                                            option = document.createElement("option");
                                            option.value = j;
                                            option.text = j;
                                            selectcampos.appendChild(option);

                                            $("." + index).append(selectcampos);
                                        });




                                    }

                                    function procesar() {
                                        var selects = $(".registros select");
                                        $(".registros select").each(function () {
                                            if ($(this).val() === null) {
                                                $(this).css("box-shadow", "0 0 1em #dc3545");
                                                $(this).tooltip('show');

                                            }
                                        });

                                        enviar();
                                    }

                                    function anterior(e) {
                                        v_anterior = $(e).val();
                                    }

                                    function enviar() {
                                        selecccionados.sort(function (a, b) {
                                            return (a.posicion - b.posicion);
                                        });
                                        console.log(JSON.stringify(selecccionados));
                                        $.ajax({
                                            type: 'POST',
                                            data: {"json": JSON.stringify(selecccionados)},
                                            url: '../Equivalencias',
                                            success: function (result) {
                                                var msj = $.parseJSON(result);

                                                $("#mensaje").show();
                                                var clase= "alert-"+msj.clase;
                                                var text = "text-"+msj.clase;
                                                $("#mensaje").toggleClass(clase);
                                                $("#mensaje div i").toggleClass(text);
                                                $("#mensaje div i").toggleClass(msj.ico);
                                                $("#mensaje div span").html(msj.mensaje);
                                                setTimeout(function () {
                                                                            $("#mensaje").fadeOut(5500);
                                                                        }, 15000);
                                                $(".registros").html(result);
                                                $(".registros").after().hide();
                                            },
                                            error: function (xhr, status, error) {
                                                var err = eval("(" + xhr.responseText + ")");
                                                alert(err.Message);

                                            }
                                        });
                                    }

                                    function accion(e) {

                                        var drop;
                                        var bandera = false;


                                        if (v_anterior !== $(e).val()) {

                                            if (selecccionados.length === 0) {
                                                selecccionados.push(new relacion($(e).attr("id").substring($(e).attr("id").indexOf("-") + 1, $(e).attr("id").length), $(e).attr("id").substring(0, $(e).attr("id").indexOf("-")), $(e).val()));

                                            } else {

                                                for (i = 0; i < selecccionados.length; i++) {
                                                    if (selecccionados[i].Id === $(e).attr("id").substring(0, $(e).attr("id").indexOf("-"))) {
                                                        bandera = true;
                                                        selecccionados.splice(i, 1);
                                                        selecccionados.push(new relacion($(e).attr("id").substring($(e).attr("id").indexOf("-") + 1, $(e).attr("id").length), $(e).attr("id").substring(0, $(e).attr("id").indexOf("-")), $(e).val()));
                                                        break;
                                                    } else {
                                                        bandera = false;
                                                    }
                                                }

                                                if (bandera === false) {
                                                    selecccionados.push(new relacion($(e).attr("id").substring($(e).attr("id").indexOf("-") + 1, $(e).attr("id").length), $(e).attr("id").substring(0, $(e).attr("id").indexOf("-")), $(e).val()));
                                                }
                                            }




                                            var selects = $(".registros select");
                                            // document.getElementsByTagName(".registros select");
                                            if ($(e).val() !== 'IGNORAR') {
                                                for (var i = 0; i < selects.length; i++) {
                                                    if (selects[i].id !== $(e).attr("id")) {

                                                        for (var j = 0; j < selects[i].length; j++) {

                                                            if (selects[i].options[j].value === $(e).val()) {
                                                                selects[i].remove(j);


                                                                if (v_anterior !== null) {
                                                                    if (v_anterior !== 'IGNORAR') {
                                                                        option = document.createElement("option");
                                                                        option.value = v_anterior;
                                                                        option.text = v_anterior;
                                                                        selects[i].appendChild(option);
                                                                    }
                                                                }



                                                            }
                                                        }
                                                    }
                                                }
                                                v_anterior = "";
                                            }
                                        }
                                    }


                                    function relacion(posicion, id, campo) {
                                        this.posicion = posicion;
                                        this.Id = id;
                                        this.Campo = campo;

                                    }

                                    function msj(display, mensaje, ico, clase) {
                                        this.mensaje = mensaje;
                                        this.display = display;
                                        this.ico = ico;
                                        this.clase = clase;
                                    }

                                    $(document).on('change', '.sel', function () {
                                        $(this).siblings().find('option[value="' + $(this).val() + '"]').remove();
                                    });

                                    //]]>
                                                                </script>
                                                                <script>
                                                                    function validar_formulario() {
                                                                        if ($('#asesormodel\\:asesores').val() === "")
                                                                        {
                                                                            $("#mesagevalidation").show();
                                                                            setTimeout(function () {
                                                                                $("#mesagevalidation").fadeOut(5500);
                                                                            }, 15000);
                                                                            return false;
                                                                        } else
                                                                        if ($('#asesormodel\\:asesores').val() === "")
                                                                        {
                                                                            $("#mesagevalidation").show();
                                                                            setTimeout(function () {
                                                                                $("#mesagevalidation").fadeOut(5500);
                                                                            }, 15000);
                                                                            return false;
                                                                        } else
                                                                            return true;


                                                                    }
                                                                </script>

           <script>
                                                                    $(document).ready(function () {
                                                                        $('.dataTable').DataTable({
                                                                            responsive: true,
                                                                            language: {
                                                                                "decimal": "",
                                                                                "emptyTable": "No hay datos",
                                                                                "info": "Mostrando _START_ a _END_ de _TOTAL_ registros",
                                                                                "infoEmpty": "Mostrando 0 a 0 de 0 registros",
                                                                                "infoFiltered": "(Filtro de _MAX_ total registros)",
                                                                                "infoPostFix": "",
                                                                                "thousands": ",",
                                                                                "lengthMenu": "Mostrar _MENU_ registros",
                                                                                "loadingRecords": "Cargando...",
                                                                                "processing": "Procesando...",
                                                                                "search": "Buscar:",
                                                                                "zeroRecords": "No se encontraron coincidencias",
                                                                                "paginate": {
                                                                                    "first": "Primero",
                                                                                    "last": "Ultimo",
                                                                                    "next": "Próximo",
                                                                                    "previous": "Anterior"
                                                                                },
                                                                                "aria": {
                                                                                    "sortAscending": ": Activar orden de columna ascendente",
                                                                                    "sortDescending": ": Activar orden de columna desendente"
                                                                                }
                                                                            },
                                                                            stateSave: true
                                                                        });

                                                                    });
                                                                </script> 
                                                                <script>

                                                                    $(document).ready(function () {

                                                                        setTimeout(function () {
                                                                            $("#mensaje").fadeOut(5500);
                                                                        }, 15000);
                                                                    });
                                                                </script>
                                                                <script>
                                                                    $(function () {

                                                                        // We can attach the `fileselect` event to all file inputs on the page
                                                                        $(document).on('change', ':file', function () {
                                                                            var input = $(this),
                                                                                    numFiles = input.get(0).files ? input.get(0).files.length : 1,
                                                                                    label = input.val().replace(/\\/g, '/').replace(/.*\//, '');
                                                                            input.trigger('fileselect', [numFiles, label]);
                                                                        });

                                                                        // We can watch for our custom `fileselect` event like this
                                                                        $(document).ready(function () {
                                                                            $(':file').on('fileselect', function (event, numFiles, label) {

                                                                                var input = $(this).parents('.input-group').find(':text'),
                                                                                        log = numFiles > 1 ? numFiles + ' files selected' : label;
                                                                                if (input.length) {
                                                                                    input.val(log);
                                                                                } else {
                                                                                    if (log)
                                                                                        alert(log);
                                                                                }

                                                                            });
                                                                        });

                                                                    });
                                                                </script>
                                                                <script>
                                                                    function validate() {
                                                                        $("#text-error").html("");
                                                                        var archivo = $("#file").val();
                                                                        var extensiones = archivo.substring(archivo.lastIndexOf("."));
                                                                        var file_size = $('#file')[0].files[0].size;
                                                                        var extensiones = archivo.substring(archivo.lastIndexOf("."));
                                                                        if (file_size > 2097152) {
                                                                            $("#modalchange").modal();
                                                                            $("#text-error").html("El Archivo es mayor a <b>2Mb</b>.");
                                                                            return false;
                                                                        } else if (extensiones !== ".xlsx") {
                                                                            $("#modalchange").modal();
                                                                            $("#text-error").html("Debe Introducir un archivo con el formato correcto (<b>.xls</b>)");
                                                                            return false;
                                                                        }
                                                                        return true;
                                                                    }

                                                                </script>
                                                                <script>
                                                                    $(function () {
                                                                        $('.cantidad').keypress(function (e) {
                                                                            if (isNaN(this.value + String.fromCharCode(e.charCode)))
                                                                                return false;
                                                                        }).on("cut copy paste", function (e) {
                                                                            e.preventDefault();
                                                                        });
                                                                    });
                                                                </script>
                                                                <script>
                                                                    $(function () {
                                                                        $('.porcentaje').keypress(function (e) {
                                                                            if (isNaN(this.value + String.fromCharCode(e.charCode)))
                                                                                return false;
                                                                        }).on("cut copy paste", function (e) {
                                                                            e.preventDefault();
                                                                        });
                                                                    });
                                                                </script>
                                                                <script>
                    var disponibles = #{subeprospectosBean.prospectospAsignar};
                    var cantidad;
                    var porcentaje;

                    $('.porcentaje').focusin(function () {
                        porcentaje = $(this).val();
                    })
                            .focusout(function () {
                                nwporcentaje = $(this).val();
                                cantidad = (nwporcentaje * disponibles) / 100;
                                if (validaporcentajes() > 100) {
                                    $(this).val(porcentaje);
                                    console.log($(this).val());
                                } else {
                                    $(this).val(nwporcentaje);
                                    console.log($(this).val());
                                    console.log(cantidad);
                                    $(this).closest('tr').find(".cantidad").each(function () {
                                        $(this).val(cantidad);
                                    });
                                    $("label[for='asig']").html(validacantidad());
                                    $("label[for='parasig']").html(disponibles - validacantidad());

                                }
                            });
                    function validaporcentajes() {
                        var totalDeuda = 0;
                        $(".porcentaje").each(function () {
                            totalDeuda += parseFloat($(this).val()) || 0;
                        });
                        console.log(totalDeuda);
                        return totalDeuda;
                    }
                    function validacantidad() {
                        var totalDeuda = 0;
                        $(".cantidad").each(function () {
                            totalDeuda += parseFloat($(this).val()) || 0;
                        });
                        return totalDeuda;
                    }
                                                        </script>
                                                        <script>
                    var disponibles = #{subeprospectosBean.prospectospAsignar};
                    var cantidad;
                    var porcentaje;
                    var psa = 0, pa = 0;

                    $('.cantidad').focusin(function () {
                        cantidad = $(this).val();
                    })
                            .focusout(function () {
                                nwcantidad = $(this).val();
                                porcentaje = (nwcantidad * 100) / disponibles;
                                if (validacantidad() > disponibles) {
                                    $(this).val(cantidad);
                                } else {
                                    $(this).val(nwcantidad);
                                    $(this).closest('tr').find(".porcentaje").each(function () {
                                        $(this).val(porcentaje.toFixed(2));
                                    });
                                    $("label[for='asig']").html(validacantidad());
                                    $("label[for='parasig']").html(disponibles - validacantidad());
                                }
                            });

                    function validacantidad() {
                        var totalDeuda = 0;
                        $(".cantidad").each(function () {
                            totalDeuda += parseFloat($(this).val()) || 0;
                        });
                        return totalDeuda;
                    }


                                                        </script>
                                                        <script>
                    var disponibles = #{subeprospectosBean.prospectospAsignar};
                    var total = 0;
                    $(".cantidad").each(function () {
                        total += parseFloat($(this).val()) || 0;
                    }
                    );
                    $("label[for='asig']").html(total);
                    $("label[for='parasig']").html(disponibles - total);

                                                        </script>

                                                        </ui:define>

                                                        </ui:composition>

                                                        </body>
                                                        </html>
