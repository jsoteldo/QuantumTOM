<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:j="http://xmlns.jcp.org/jsf"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:a="http://xmlns.jcp.org/jsf/passthrough">

    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link href="../resources/css/default.css" rel="stylesheet"/>
        <link href="../resources/css/dataTables.bootstrap4.css" rel="stylesheet"/>
        <link href="../resources/css/bootstrap.min.css" rel="stylesheet"/>
        <link href="../resources/css/sb-admin.css" rel="stylesheet"/>
        <link href="../resources/fontawesome-free/css/all.min.css" rel="stylesheet"/>
        <link rel="stylesheet" href="http://jqueryvalidation.org/files/demo/site-demos.css"/>

        <title>Quantum - Flamencos</title>

    </head>

    <body>

        <ui:composition template="./plantilla.xhtml">

            <ui:define name="content">

                <div class="container-fluid">

                    <!-- Breadcrumbs-->
                    <div class="row flex-grow">
                        <div class="card col-xs-12 col-sm-12 col-md-12 col-lg-6 col-xl-5 d-flex align-items-stretch" style="margin-bottom: 10px;">
                            <div class="card-body" style="padding: 0.5rem 0.5rem !important;">
                                <div class="media">
                                    <i class="mdi mdi-lock icon-md text-primary d-flex align-self-start mr-2"></i>
                                    <div class="media-body">
                                        <p class="card-text"><h3 class="card-title">Cambio de Contraseña</h3></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <form j:id="formcontrasena" class="forms-sample">
                        <div class="row flex-grow">
                            <div class="card col-xs-12 col-sm-12 col-md-12 col-lg-6 col-xl-5 d-flex align-items-stretch grid-margin">
                                <div class="card-body">
                                    <div class="form-group">
                                        <div class="form-label-group">
                                            <label for="contrasena">Contraseña Actual</label>
                                            <input type="password" j:id="contrasena" class="form-control" placeholder="Password"  j:value="#{usuariosBean.asesores.contrasena}" required="true"/>
                                        </div>
                                    </div> 
                                    <div class="form-group">
                                        <div class="form-label-group">
                                            <label for="password">Contraseña Nueva</label>
                                            <div class="input-group col-xs-12">
                                                <input type="password" name="password" j:id="password" class="form-control" placeholder="Nuevo Password"  j:value="#{usuariosBean.asesores.new_contra}"/>
                                                <span class="input-group-text bg-transparent" id="seenueva">
                                                    <i class="mdi mdi-eye text-gray"></i>
                                                </span>
                                            </div>
                                        </div> 
                                    </div>    
                                    <div class="form-group">
                                        <div class="form-label-group">
                                            <label for="password_again">Confirmación de Nueva Contraseña</label>
                                            <div class="input-group col-xs-12">
                                                <input type="password" name="password_again" j:id="password_again" class="form-control" placeholder="Repite el Password"  j:value="#{usuariosBean.asesores.repite_contra}" required="true"/>
                                                <span class="input-group-text bg-transparent" id="seerepeat" >
                                                    <i class="mdi mdi-eye text-gray"></i>
                                                </span>
                                            </div>
                                        </div>
                                    </div> 
                                    <div id="mensaje" style="display: none" class="alert  form-row">
                                        <div class="col-3">
                                            <i id="icomesage" class="mdi icon-md "></i>
                                        </div>
                                        <div class="col-8">
                                            <span id="textmesage" class="font-weight-medium text-right">
                                                <ul >
                                                    <li id="letra" class="text-danger">Al menos <strong>una letra minuscula</strong>
                                                    </li>
                                                    <li id="mayuscula" class="text-danger">Al menos <strong>una letra mayuscula</strong>
                                                    </li>
                                                    <li id="numero" class="text-danger">Al menos  <strong>un numero</strong>
                                                    </li>
                                                    <li id="longitud" class="text-danger">Sea al menos <strong>8 caracteres</strong>
                                                    </li>
                                                </ul>
                                            </span>
                                        </div>
                                    </div>
                                    <div id="mensaje2" style="display: #{usuariosBean.message.display}" class="alert alert-#{usuariosBean.message.clase} form-row">
                                        <div class="col-3">
                                            <i id="icomesage2" class="mdi #{usuariosBean.message.ico} text-#{usuariosBean.message.clase} icon-md "></i>
                                        </div>
                                        <div class="col-8">
                                            <span id="textmesage2" class="font-weight-medium text-right">
                                                <div style="display: #{usuariosBean.message.display}">#{usuariosBean.message.mensaje}</div>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="template-demo">
                                        <button type="submit" id="registrar" disabled="" class="btn btn-success mr-2" j:actionListener="#{usuariosBean.cambiocontrasena()}">
                                            Cambiar
                                        </button>
                                        <button type="reset" id="cancelar" class="btn btn-light">Cancel</button>
                                    </div>
                                </div>
                            </div>


                        </div>
                    </form>
                </div>                                                                                                                     
                <script src="../resources/js/jquery-3.3.1.min.js"></script>
                <script src="../resources/js/bootstrap-formhelpers.min.js"></script>

                <script>

                    $(document).ready(function () {
                        $("#seenueva").mouseover(function () {
                            $("#formcontrasena\\:password").removeAttr('type');
                        });
                        $("#seenueva").mouseout(function () {
                            $("#formcontrasena\\:password").attr('type', 'password');
                        });
                        $("#seerepeat").mouseover(function () {
                            $("#formcontrasena\\:password_again").removeAttr('type');
                        });
                        $("#seerepeat").mouseout(function () {
                            $("#formcontrasena\\:password_again").attr('type', 'password');
                        });
                    });
                </script>
                <script>
                    //<![CDATA[ 
                    $(document).ready(function () {
                        var longitud = false,
                                minuscula = false,
                                numero = false,
                                mayuscula = false;
                        $('#icomesage').addClass("text-danger mdi-close-circle-outline");
                    });
                    var verificacontra = function () {
                        var pswd = $(this).val();

                        if (pswd.length < 8) {
                            $('#longitud').removeClass('text-success').addClass('text-danger');
                            longitud = false;
                        } else {
                            $('#longitud').removeClass('text-danger').addClass('text-success');
                            longitud = true;
                        }

                        //validate letter
                        if (pswd.match(/[a-z]/)) {
                            $('#letra').removeClass('text-danger').addClass('text-success');
                            minuscula = true;
                        } else {
                            $('#letra').removeClass('text-success').addClass('text-danger');
                            minuscula = false;
                        }

                        //validate capital letter
                        if (pswd.match(/[A-Z]/)) {
                            $('#mayuscula').removeClass('text-danger').addClass('text-success');
                            mayuscula = true;
                        } else {
                            $('#mayuscula').removeClass('text-success').addClass('text-danger');
                            mayuscula = false;
                        }

                        //validate number
                        if (pswd.match(/\d/)) {
                            $('#numero').removeClass('text-danger').addClass('text-success');
                            numero = true;
                        } else {
                            $('#numero').removeClass('text-success').addClass('text-danger');
                            numero = false;
                        }

                        if (longitud === true && numero === true && mayuscula === true && minuscula === true) {
                            $('#mensaje').removeClass("alert-danger").addClass("alert-success");
                            $('#icomesage').removeClass("text-danger mdi-close-circle-outline").addClass("text-success mdi-checkbox-marked-circle-outline");
                            $('#registrar').removeAttr('disabled', 'disabled');
                        } else {
                            $('#mensaje').show();
                            $('#mensaje').addClass("alert-danger");
                            $('#registrar').attr('disabled', 'disabled');
                        }
                    };

                    $('#formcontrasena\\:password').on('keyup', verificacontra).blur(function () {
                        $('#mensaje').hide();
                    });

                    $('#formcontrasena\\:password').keyup(function (e) {
                        if (e.keyCode === 8) {
                            $('#formcontrasena\\:password').val("");
                            $('#formcontrasena\\:password_again').val("");
                            $('#longitud').removeClass('text-success').addClass('text-danger');
                            $('#numero').removeClass('text-success').addClass('text-danger');
                            $('#mayuscula').removeClass('text-success').addClass('text-danger');
                            $('#letra').removeClass('text-success').addClass('text-danger');
                        }
                    });


                    //]]>
                </script>
                <script>
                    $(document).ready(function () {
                        $("#formcontrasena").submit(function () {
                            if (cambioDePass()) {
                                return true;
                            } else
                                return false;
                        });
                    });
                    function cambioDePass() {
                        var cont = $("#formcontrasena\\:password").val();
                        var cont2 = $("#formcontrasena\\:password_again").val();
                        if (cont !== cont2) {
                            $('#mensaje').hide();
                            $('#mensaje').show();
                            $('#textmesage').html("Las constraseñas no coinciden");
                            $('#registrar').removeAttr("disabled");
                            $('#mensaje').addClass("alert-danger").removeClass("alert-success");
                            $('#icomesage').addClass("text-danger mdi-close-circle-outline").removeClass("text-success mdi-checkbox-marked-circle-outline");
                            return false;
                        } else {
                            return true;
                        }
                    }

                </script>
                <script>

                    $(document).ready(function () {

                        setTimeout(function () {
                            $("#mensaje2").fadeOut(1500);
                        }, 3000);
                    });
                </script>
            </ui:define>

        </ui:composition>

    </body>
</html>